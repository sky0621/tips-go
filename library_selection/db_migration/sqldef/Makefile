# Makefile for managing local sqldef sample environment

DOCKER_COMPOSE ?= docker compose
DOCKER_COMPOSE_FILE ?= docker-compose.yml

MYSQL_CONTAINER_NAME ?= sqldef-mysql
MYSQL_IMAGE ?= mysql:8.0
MYSQL_HOST ?= 127.0.0.1
MYSQL_PORT ?= 6306
MYSQL_ROOT_PASSWORD ?= root
MYSQL_DATABASE ?= sample
MYSQL_USER ?= app
MYSQL_PASSWORD ?= app

GO_MODULE ?= ./sample

SQLDEF_MYSQL_HOST ?= $(MYSQL_HOST)
SQLDEF_MYSQL_PORT ?= $(MYSQL_PORT)
SQLDEF_MYSQL_USER ?= $(MYSQL_USER)
SQLDEF_MYSQL_PASSWORD ?= $(MYSQL_PASSWORD)
SQLDEF_MYSQL_DATABASE ?= $(MYSQL_DATABASE)

export SQLDEF_MYSQL_HOST
export SQLDEF_MYSQL_PORT
export SQLDEF_MYSQL_USER
export SQLDEF_MYSQL_PASSWORD
export SQLDEF_MYSQL_DATABASE
export MYSQL_CONTAINER_NAME
export MYSQL_IMAGE
export MYSQL_PORT
export MYSQL_ROOT_PASSWORD
export MYSQL_DATABASE
export MYSQL_USER
export MYSQL_PASSWORD

.PHONY: mysql-start mysql-stop go-run

mysql-start:
	$(DOCKER_COMPOSE) -f $(DOCKER_COMPOSE_FILE) up -d

mysql-stop:
	$(DOCKER_COMPOSE) -f $(DOCKER_COMPOSE_FILE) down

go-run:
	@(cd $(GO_MODULE) && go run .)
